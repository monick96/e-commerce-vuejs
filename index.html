<!doctype html>
<html lang="en">

<head>
    <title>E-Commerce</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR2m4OCIdWncZaWe1xovQ2xsxGb-YGHmi76GA&usqp=CAU" type="image/x-icon">

    
    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">

</head>

<body>
    <div id="app">
        <header>
            <h3>E-Commerce</h3>
            <button class="cart" v-on:click="cartOpen = !cartOpen">Shopping Cart ({{cart.length}})</button>
            <div class="cart-content" v-show="cartOpen">
                <div class="cart-content__product" v-for="(product,index) in cart" :key="index" :class="{'bg-gray': index & 1}">
                    <img v-bind:src="product.images[0].image" :alt="product.name.toUpperCase()">
                    <span>{{product.name}}  -  {{new Intl.NumberFormat("es-AR", { style: 'currency', currency: 'ARS', minimumFractionDigits: 0 }).format(product.price)}} ({{product.quantity}})</span>
                </div>
                <p>Total:  {{new Intl.NumberFormat("es-AR", { style: 'currency', currency: 'ARS', minimumFractionDigits: 0 }).format(total) }}</p>
            </div>
        </header>
        <main>
            <product v-for="product in products" :Key="product.name" :product="product" @sendtocart="addToCart($event)"></product>
            

        </main>
        <footer>
            <!-- place footer here -->
        </footer>
    </div>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
        </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
    </script>
    <!-- vue js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const {createApp,ref,reactive, toRefs, watch, computed} = Vue;
    //reactive para agrupar toda la info en un solo estado
    //como data(), reactive() contiene propiedades reactivas
    //con reactive()


    const app = createApp({
        setup(){
            const products = ref([
                {
                    name:"Camera 1",
                    price: 400_000,
                    stock:12,
                    content:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quia velit aspernatur voluptatibus harum illo corporis nam, a commodi est doloremque vero autem hic nulla, cum non excepturi iusto, fugit voluptate",
                    images:[ 
                        {
                            image:"https://i01.appmifile.com/webfile/globalimg/products/m/mi-360-home-security-camera-2k/overview_01.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOtnXJ0k6SlzdgmVQVgGz3PcdBcxRTUpjaZQ&usqp=CAU"
                        },
                        {
                            image:"https://upload.wikimedia.org/wikipedia/commons/4/4f/YI_1080P_Home_Camera_Photo.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGddu3MsmzENjoU7NU2fnFU9Uk-mBK1GOinw&usqp=CAU",
                        }
                ],
                new:false,
                offer:true,
                quantity:1
                },
                {
                    name:"Camera 2",
                    price: 400_000,
                    stock:8,
                    content:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quia velit aspernatur voluptatibus harum illo corporis nam, a commodi est doloremque vero autem hic nulla, cum non excepturi iusto, fugit voluptate",
                    images:[ 
                        {
                            image:"https://i01.appmifile.com/webfile/globalimg/products/m/mi-360-home-security-camera-2k/overview_01.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOtnXJ0k6SlzdgmVQVgGz3PcdBcxRTUpjaZQ&usqp=CAU"
                        },
                        {
                            image:"https://upload.wikimedia.org/wikipedia/commons/4/4f/YI_1080P_Home_Camera_Photo.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGddu3MsmzENjoU7NU2fnFU9Uk-mBK1GOinw&usqp=CAU",
                        }
                ],
                new:true,
                offer:true,
                quantity:1
                },
                {
                    name:"Camera 3",
                    price: 400_000,
                    stock:10,
                    content:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quia velit aspernatur voluptatibus harum illo corporis nam, a commodi est doloremque vero autem hic nulla, cum non excepturi iusto, fugit voluptate",
                    images:[ 
                        {
                            image:"https://i01.appmifile.com/webfile/globalimg/products/m/mi-360-home-security-camera-2k/overview_01.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOtnXJ0k6SlzdgmVQVgGz3PcdBcxRTUpjaZQ&usqp=CAU"
                        },
                        {
                            image:"https://upload.wikimedia.org/wikipedia/commons/4/4f/YI_1080P_Home_Camera_Photo.jpg",
                            thumbnail:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGddu3MsmzENjoU7NU2fnFU9Uk-mBK1GOinw&usqp=CAU",
                        }
                ],
                new:true,
                offer:false,
                quantity:1
                }
            ])
            
            //desestructuring para no tener que estar agregando el productState en todos los lugares donde se usaban como product
            //const {product} = productState;
            
            const cartState = reactive({
                cartOpen:false,
                cart:[],
                //total:0
            });
            //desestructuring para no tener que estar agregando el cartState en todos los lugares donde se usaban como cart
            const {cart} = cartState;

             //instead watch used computed properties to change total products in cart of product
            //or other way is declareted directly in cart state
            const total = computed(() => {
                return cartState.cart.reduce((prev,curr)=>{
                    const prevPrice = prev.price || prev;
                    const prevQuantity = prev.quantity || 1;
                    return prevPrice * prevQuantity + curr.price * curr.quantity
                },0);
            })

            function addToCart (product) {
                const prodIndex = cart.findIndex(prod=> prod.name === product.name)
                
                if(prodIndex>= 0){
                    cart[prodIndex].quantity += 1;
                }else{
                    cart.push(product)
                }
                product.stock-=1
            }


            // setTimeout(() => {
            //     activeImage.value = 1
            // }, 2000);
            /*
            watch(cartState.cart,(val,oldVal) => {
                cartState.total = cartState.cart.reduce((prev,curr)=>{
                    const prevPrice = prev.price || prev;
                    const prevQuantity = prev.quantity || 1;
                    return prevPrice * prevQuantity + curr.price * curr.quantity
                },0);
            }) 
            */
            return{
                ...toRefs(cartState),
                total,
                addToCart,
                products

            };

        }
    })
    </script>
    <script src="./badge.js"></script>
    <script src="./product.js"></script>
    <script>
        app.mount("#app")
    </script>
    <!-- <script src="./main_reactive.js"></script> -->
    <!-- <script src="./main_ref.js"></script> -->


</body>

</html>